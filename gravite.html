<!-- ___________________________________________________ -->
<!--  NOM DU SCRIPT: gravite.html                        -->
<!--  REALISATION INFORMATIQUE:     Jean-Michel Hinicker -->
<!--  DATE DE CREATION:                       22/02/2019 -->
<!--  DATE DE DERNIERE MODIFICATION:          28/02/2019 -->
<!--  OBJET: Simulation de soleil ou trou noir           -->
<!-- ___________________________________________________ -->

<!DOCTYPE html>
<html lang="fr">
    <head>
        <title>Gravité Newtonnienne</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
        <link rel="stylesheet" href="gravite.css">
    </head>
    <body>
        <div class="container">
            <div class="row" id="ecran">
                <canvas id="espace" width="1500" height="900" class="d-block mx-auto"></canvas>
            </div>
            <div class="row" id="interface_commande">
                <p>
                    <button id="gravite_start">Démarrer</button>
                    <button id="gravite_stop">Stopper</button>
                    <label for="gravite_speed">Vitesse max:
                        <input type="range" id="gravite_speed" min="1" max="100" step="1" value="1" >
                    </label>

                </p>
                <form method="post" action="" name="infos">
                    <div class="input-group mb-3 input-group-sm">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Constante gravitationnelle</span>
                        </div>
                        <input type="text" class="form-control" name="h">
                    </div>
                    <div class="input-group mb-3 input-group-sm">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Masse du trou noir</span>
                        </div>
                        <input type="text" class="form-control">
                    </div>
                    <div class="input-group mb-3 input-group-sm">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Nombre d'astres de class 1</span>
                        </div>
                        <input type="text" class="form-control">
                    </div>
                    <div class="input-group mb-3 input-group-sm">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Masse des astres de class 1</span>
                        </div>
                        <input type="text" class="form-control">
                    </div>
                    <div class="input-group mb-3 input-group-sm">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Nombre d'astres de class 2</span>
                        </div>
                        <input type="text" class="form-control">
                    </div>
                    <div class="input-group mb-3 input-group-sm">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Masse des astres de class 2</span>
                        </div>
                        <input type="text" class="form-control">
                    </div>
                    <div class="input-group mb-3 input-group-sm">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Nombre d'astres de class 3</span>
                        </div>
                        <input type="text" class="form-control">
                    </div>
                    <div class="input-group mb-3 input-group-sm">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Masse des astres de class 3</span>
                        </div>
                        <input type="text" class="form-control">
                    </div>
                    <div class="input-group mb-3 input-group-sm">
                        <input type="submit" class="form-control">
                    </div>
                </form>
            </div>
        </div>
        <script src="https://preview.babylonjs.com/babylon.js"></script>
        <script src="https://preview.babylonjs.com/inspector/babylon.inspector.bundle.js"></script>
        <script src="https://preview.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
        <script src="https://preview.babylonjs.com/materialsLibrary/babylonjs.materials.min.js"></script>
        <script src="https://preview.babylonjs.com/postProcessesLibrary/babylonjs.postProcess.min.js"></script>
        <script src="https://preview.babylonjs.com/gui/babylon.gui.min.js"></script>
        <script src="https://preview.babylonjs.com/proceduralTexturesLibrary/babylonjs.proceduralTextures.min.js"></script>
        <script src="https://preview.babylonjs.com/serializers/babylonjs.serializers.min.js"></script>
        <script src="https://preview.babylonjs.com/nodeEditor/babylon.nodeEditor.js"></script>
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
        <script src="gravite.js"></script>
        <script>
            window.addEventListener('DOMContentLoaded', function(){
                // ciblage de l'élément DOM canvas
                var canvas = document.getElementById('espace');
                // chargement du moteur 3D
                var engine = new BABYLON.Engine(canvas, true);

                var createScene = function(){
            
                    var scene = new BABYLON.Scene(engine);
                    scene.clearColor = new BABYLON.Color3(.1, .1, .1);
                    scene.collisionsEnabled = true;
                    scene.receiveShadows = true;
                    
                    // Création de notre lumière principale
                    var light = new BABYLON.PointLight("Omni", new BABYLON.Vector3(0, 0, 0), scene);
                    var cameraSun = new BABYLON.FreeCamera('cameraSun', new BABYLON.Vector3(0, 0, -400), scene);
                    cameraSun.setTarget(BABYLON.Vector3.Zero());
                    cameraSun.attachControl(canvas, false);
                    
                    var sun = new BABYLON.VolumetricLightScatteringPostProcess('sun', 1.0, scene.activeCamera, null, 100, BABYLON.Texture.BILINEAR_SAMPLINGMODE, engine, false);
                    sun.mesh.material.diffuseTexture = new BABYLON.Texture('./public/sun.png', scene, true, false, BABYLON.Texture.BILINEAR_SAMPLINGMODE);
                    sun.mesh.material.diffuseTexture.hasAlpha = true;
                    sun.mesh.position = new BABYLON.Vector3(0, 0, 0);
                    sun.mesh.scaling = new BABYLON.Vector3(150, 150, 150);
                    light.position = sun.mesh.position;
                    light.intensity = 1;
                    sun.useDiffuseColor = true;
                   
                   
                    // Trou noir
                    var blackHoleSun = BABYLON.Mesh.CreateSphere('soleil', 20, 150, scene);
                    var blackHoleSunTexture = new BABYLON.StandardMaterial("surfaceTrouNoir", scene);
                    blackHoleSunTexture.diffuseTexture = new BABYLON.Texture("./public/blacksun.png", scene);
                    blackHoleSunTexture.emissiveTexture = new BABYLON.Texture("./public/blacksun.png", scene);
                    blackHoleSun.material = blackHoleSunTexture;
                    blackHoleSun.position.y = 0;
                    blackHoleSun.position.x = 0;
                    blackHoleSun.position.z = 0;

                    return scene;
                }

                var scene = createScene();

                engine.runRenderLoop(function(){
                    scene.render();
                });

                window.addEventListener('resize', function(){
                    engine.resize();
                });
            });
           
        </script>
    </body>
</html>